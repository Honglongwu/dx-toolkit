#!/usr/bin/env python

import os, sys, json, fileinput, re
import dxpy

if '-h' in sys.argv:
    print 'usage: ' + sys.argv[0] + ' FILENAME ...'
    print ''
    print 'Grabs chromosomes from the SAM headers and stores them in details of records on the DNAnexus platform'
    exit(0)

chromosomes = []; i = 0

for line in fileinput.input():
    if re.match("^\@", line) == None:
        break
    if re.match("^\@SQ", line) == None:
        continue
    seqname, seqlen = re.search("^\@SQ\s+SN:(.+?)\s+LN:(.+)$", line).groups()
    chromosomes.append([seqname, i, int(seqlen)])
    i += 1

j = dxpy.new_dxrecord(details={"name": "some_genome", "chromosomes": chromosomes})
j.close()

properties = j.describe()
properties.update(j.get_properties())
properties.update(j.get_details())
print json.dumps(properties)
