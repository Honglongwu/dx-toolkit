#!/usr/bin/env python

import os, sys, json, re

preamble = '''// Do not modify this file by hand.
//
// It is automatically generated by src/api_wrappers/generateCppAPIHWrappers.py.
// (Run make api_wrappers to update it.)

#ifndef DXCPP_API_H
#define DXCPP_API_H

#include "dxjson/dxjson.h"
'''

postscript = '''
#include "dxcpp.h"

#endif
'''

class_method_template = '''
dx::JSON {method_name}(const std::string &input_params="{{}}");
dx::JSON {method_name}(const dx::JSON &input_params);
'''

object_method_template = '''
dx::JSON {method_name}(const std::string &object_id, const std::string &input_params="{{}}");
dx::JSON {method_name}(const std::string &object_id, const dx::JSON &input_params);
'''

# Overloads with alias are named differently to eliminate ambiguity between
# method(app_id_or_name, input_params) and method(app_name, app_alias)
app_object_method_template = '''
dx::JSON {method_name}(const std::string &app_id_or_name, const std::string &input_params="{{}}");
dx::JSON {method_name}(const std::string &app_id_or_name, const dx::JSON &input_params);
dx::JSON {method_name}WithAlias(const std::string &app_name, const std::string &app_alias, const std::string &input_params="{{}}");
dx::JSON {method_name}WithAlias(const std::string &app_name, const std::string &app_alias, const dx::JSON &input_params);
'''

print preamble

for method in json.loads(sys.stdin.read()):
    route, signature, opts = method
    method_name = signature.split("(")[0]
    if (opts['objectMethod']):
        root, oid_route, method_route = route.split("/")
        if oid_route == 'app-xxxx':
            print app_object_method_template.format(method_name=method_name, method_route=method_route)
        else:
            print object_method_template.format(method_name=method_name, method_route=method_route)
    else:
        print class_method_template.format(method_name=method_name, route=route)

print postscript
