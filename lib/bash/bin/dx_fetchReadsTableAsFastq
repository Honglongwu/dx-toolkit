#!/usr/bin/env python

import os, sys, json, tempfile
from optparse import OptionParser
import dxpy

parser = OptionParser("Usage: %prog table_id start_row end_row")
(opts, args) = parser.parse_args()
if len(args) != 3:
    parser.error("Incorrect number of arguments")

dx_table, start_row, end_row = args

if (int(end_row) <= int(start_row)):
    parser.error("End row %s must exceed start row %s" % (end_row, start_row))

security_context=json.loads(os.environ['SECURITY_CONTEXT'])

cur_offset = int(start_row); step = 80000
cur_row = cur_offset; end_row = int(end_row)
try:
    while True:
        response = dxpy.getRowsFromTable(dx_table, offset=cur_offset, limit=min(step, end_row - cur_row), security_context=security_context)
        if len(response["rows"]) == 0:
            break
        for row in response["rows"]:
            print "\n".join(["@"+row[0], row[1], "+", row[2]])
            cur_row += 1
            if cur_row > end_row:
                raise StopIteration()
        cur_offset += step
except StopIteration:
    pass
