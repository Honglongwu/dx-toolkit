#!/usr/bin/env python

import os, sys, json, fileinput, re, csv
from optparse import OptionParser
import dxpy

parser = OptionParser(usage="%prog [options] table_id", description="Download a table and save it to CSV.")
parser.add_option("--no_header", help="Do not print a header in the CSV file", action='store_true', default=False)
(opts, args) = parser.parse_args()

if len(args) != 1:
    parser.error("Incorrect number of arguments")

table_id = args[0]

writer = csv.writer(sys.stdout)

dxtable = dxpy.open_dxtable(table_id)

if not opts.no_header:
    writer.writerow(map(lambda(x): x.split(":")[0], dxtable.describe()["columns"]))

for row in dxtable:
    writer.writerow(row)
