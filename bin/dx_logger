#!/usr/bin/env python
#
# reads lines for stdin and adds them to the log.
#

import os, sys
from optparse import OptionParser
sys.path.append(os.path.abspath(os.path.dirname(__file__) + '/../lib/python/dxpy'))

from log import DXLog

# assumes this program is in nucleus/client/bin
if os.environ.get('DX_ROOT') is None:
    dx_root = os.path.abspath(os.path.dirname(__file__) + '/../../../')
else:                               
    dx_root = os.environ['DX_ROOT'] 


def main():

    parser = OptionParser(usage="usage: %prog [options]", description="reads lines from stdin and writes the to the log")

    parser.add_option("-v", "--verbose",
                      help='print log messages to stderr',
                      action="store_true", dest="verbose")

    parser.add_option("-l", "--level", 
                      help='message level (e.g. warn)',
                      action="store", type="choice", 
                      choices=DXLog.LEVELS, 
                      dest="level")


    (options, args) = parser.parse_args()

    if options.verbose:
        DXLog.verbose()


    while True:
        s = sys.stdin.readline()
        if not s:
            break

        if options.level:
            DXLog.log(options.level, s.strip())
        else:
            DXLog.info(s.strip())


if __name__ == "__main__":
    main()

