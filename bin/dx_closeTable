#!/usr/bin/env python

import os, sys, json, fileinput, re
from optparse import OptionParser
import dxpy

parser = OptionParser(usage="%prog [options] table_id", description="Close a DNAnexus table.")
parser.add_option("--no_block", help="Do not wait for the table to close", action='store_true', default=False)
(opts, args) = parser.parse_args()

if len(args) != 1:
    parser.error("Incorrect number of arguments")

table_id = args[0]

table = dxpy.open_dxtable(table_id)

if table.describe()['state'] == 'closed':
    print "Table %s is already closed" % table_id
    sys.exit()

if opts.no_block:
    table.close()
else:
    table.close(block=True)
